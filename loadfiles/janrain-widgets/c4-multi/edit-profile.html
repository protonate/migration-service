<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="//www.channel4.com/static/globalnav/css/globalnav.css" type="text/css">
    <link href="https://www.channel4.com/static/global/css/4od/reset.css" type="text/css" rel="stylesheet">
    <link href="https://www.channel4.com/static/global/css/4od/elements.css" type="text/css" rel="stylesheet">
    <link href="https://www.channel4.com/static/global/css/4od/structure.css" type="text/css" rel="stylesheet">
    <link href="https://www.channel4.com/static/global/css/4od/modules.css" type="text/css" rel="stylesheet">
    <link href="https://www.channel4.com/static/identity/css/identity.css" type="text/css" rel="stylesheet">
    <script type="text/javascript">
                (function() {
                    if (typeof window.janrain !== 'object') window.janrain = {};
                    window.janrain.settings = {};
                    window.janrain.settings.capture = {};
    
                    janrain.settings.appUrl = 'https://channel4-test.rpxnow.com';
    
                    // you need to define these next two settings yourself
                    // these are for my dev system
                    
                    janrain.settings.custom = true;
                    janrain.settings.capture.appId = 'qfm5yezrh9388mj3d5kbcw7egh';
                    janrain.settings.capture.federate = true;
                    janrain.settings.capture.federateServer = 'https://channel4-test.janrainsso.com';
                    janrain.settings.capture.federateXdReceiver = 'http://janrain-widgets.s3.amazonaws.com/c4-multi/xdcomm.html';
                    janrain.settings.capture.federateLogoutUri = 'http://janrain-widgets.s3.amazonaws.com/c4-multi/logout.html';
                    janrain.settings.capture.redirectUri = 'http://janrain-widgets.s3.amazonaws.com/c4-multi/index.html';
                    janrain.settings.capture.clientId = 'msd3jt9k48mat2qe429yrr6tnjew76a7';
                    janrain.settings.capture.recaptchaPublicKey = '6LeVKb4SAAAAAGv-hg5i6gtiOV4XrLuCDsJOnYoP';
                    janrain.settings.capture.responseType = 'token';
                    janrain.settings.capture.captureServer = 'https://channel4-test.dev.janraincapture.com';
                    janrain.settings.capture.registerFlow = 'socialRegistration';
                    janrain.settings.capture.flowVersion = 'HEAD';
                    janrain.settings.capture.flowName = 'editProfile';
                    janrain.settings.capture.stylesheets = ['stylesheets/channel4.css'];
    
                    janrain.settings.type = 'embed';
                    janrain.settings.tokenUrl = 'http://channel4.com/';
                    janrain.settings.tokenAction = 'event';
                    janrain.settings.format = 'one column';
                    janrain.settings.providers = ['facebook', 'twitter','google'];
	                janrain.settings.providersPerPage = 3;
    	            janrain.settings.width = '220';
        	        janrain.settings.showAttribution = false;
	                janrain.settings.actionText = ' ';
					janrain.settings.borderRadius = 0;
                    janrain.settings.borderColor = '#ffffff';
                    janrain.settings.backgroundColor = '#ffffff';
                    janrain.settings.language = 'en';
    
                    janrain.settings.packages = ['login', 'capture'];
    
                    function isReady() { janrain.ready = true; };
                    if (document.addEventListener) {
                        document.addEventListener("DOMContentLoaded", isReady, false);
                    } else {
                        window.attachEvent('onload', isReady);
                    }
    
                    var e = document.createElement('script');
                    e.type = 'text/javascript';
                    e.id = 'janrainAuthWidget'
    
                    var url = document.location.protocol === 'https:' ? 'https://' : 'http://';
                    url += 'janrain-widgets.s3.amazonaws.com';
                    url += '/c4-multi/load.js';
                    e.src = url;
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(e, s);
                })();
    
                function janrainWidgetOnload() {
    
                }
                function janrainCaptureWidgetOnLoad() {
                janrain.capture.ui.start();
                    janrain.events.onCaptureLinkAccountError.addHandler(function(result) {
                        console.log(result);
                    });
                    janrain.events.onCaptureProfileSaveSuccess.addHandler(function(result){
                            if (result.screen !== "changepassword") window.location = "account-updated.html";
                    });
                    janrain.events.onCaptureLoginStart.addHandler(function(result){
                        console.log('loginStart', result)
                    });
                    janrain.events.onCaptureRegistrationStart.addHandler(function(result){
                        console.log('registrationStart', result)
                    });
    
                    janrain.events.onCaptureLoginSuccess.addHandler(function(result){
                        janrain.capture.ui.modal.close();
                        alert('huzzah, you just logged in and got an accessToken of ' + result.accessToken);
                        var linkA = document.createElement('a');
                        linkA.href = 'edit-profile.html';
                        linkA.innerHTML = 'edit profile';
                        document.body.appendChild(linkA);
                    });
                    janrain.events.onCaptureRegistrationSuccess.addHandler(function(result){
                        janrain.capture.ui.modal.close();
                        alert('huzzah, you just logged in and got an accessToken of ' + result.accessToken);
                    });
                    janrain.events.onCaptureValidationFailed.addHandler(function(result){
                            //if (window.console && window.console.log) console.log('validation fail', result)
                    });
                    janrain.events.onCaptureValidationSuccess.addHandler(function(result){
                            //if (window.console && window.console.log) console.log('validation success', result)
                    });
                    janrain.capture.ui.postCodeHandler = function(result) {
                        janrain.capture.ui.postCodeResult = result;
                    };
                    
                    janrain.capture.ui.registerFunction('emailValidation', function(name, value) {
                        var emailRegex = /^[_A-Za-z0-9%+-]+(\.[_A-Za-z0-9%+-]+)*@(?:[A-Za-z0-9-]+\.)+[A-Za-z]{2,50}\b/;
                        if (emailRegex.test(value)) {
                            return true;
                        } else {
                            return false;
                        }
                    });
                    
                    janrain.capture.ui.registerFunction('postcodeValidation', function(name, value, validation) {
                        validation.pending();
                        var postCodeService = 'http://clientdev.pacificeast.com/Services/PostalVerification/1_0/postalverification.svc/',
                            postCodeValue = validation.getElement().value.replace(/\s/g,''),
                            jobCode = 'Test+query',
                            referenceId = '123456',
                            callbackName = 'janrain.capture.ui.postCodeHandler',
                            postCodeRegExp = /^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))) {0,1}[0-9][A-Za-z]{2})$/,
                            callback = function() {
                                validation.pending();
                                if (!janrain.capture.ui.postCodeResult) {
                                    validation.notValid("Postcode: the postcode you have entered isn't valid. Please re-enter it.");
                                    return false;
                                }
                                if (janrain.capture.ui.postCodeResult.ResultCode === 1) {
                                    validation.getElement().value = janrain.capture.ui.postCodeResult.PostalCode;
                                    validation.valid();
                                    return true;
                        } else {
                                    if (janrain.capture.ui.postCodeResult.ErrorMessage) {
                                        validation.notValid("Postcode: " + janrain.capture.ui.postCodeResult.ErrorMessage);
                                        return false;
                                    } else {
                                        validation.notValid("Postcode: the postcode you have entered isn't valid. Please re-enter it.");
                                        return false;
                                    }
                                }
                            },
                            timeoutCallback = function(result) {
                                document.getElementById('capture_editProfileLayout_postcodeValidated').value = false;
                                validation.valid();
                            };
                        
                        if (postCodeRegExp.test(postCodeValue)) {
                            validation.pending();
                            janrain.capture.ui.scriptLoader( postCodeService + '3rTf9mO$2kP/uk/' + postCodeValue + '?JobCode=' + jobCode + '&referenceID=' + referenceId + '&callback=' + callbackName)
                                              .setCallback(callback)
                                              .setTimeoutLimit(200)
                                              .setTimeoutCallback(timeoutCallback)
                                              .load();
                        } else {
                            validation.notValid("Postcode: the postcode you have entered isn't valid. Please re-enter it.");
                            return false;
                        }
                    });
                    janrain.events.onCaptureValidationFailed.addHandler(function(){
                        var _button = document.getElementById('capture_editProfileLayout_submitButton');
                        _button.style.display = 'block';
                        _button.innerHTML = "<span>Save Changes</span>";
                        _button.previousSibling.style.display = 'none';
                    });
                    janrain.events.onCaptureValidationComplete.addHandler(function(obj){
                    });
                }
            </script>
    </head>
    <body class="login identity hasBackground" style="background-image:url(https://www.channel4.com/static/identity/css/img/login-bg/father_ted.jpg);">
        <div class="main-wrapper cf">
            <div class="content-wrapper cf">
                <div class="main-content">
                    <h1 class="header-banner my-ac"><span class="accessibility">Sign in</span></h1>
                    <div style="display:none;" id="editProfileLayout">
                        <h2 class="header-strap">This face looks familiar</h2>
                        {* editProfileForm *}
                        <div class="capture_left">
                            {* displayName *}
                            {* firstName *}
                            {* lastName *}
                            {* email *}
                            {* resendLink *}
                            <div class="capture_form_item">
                            {* errorMessages *}{* submitButton *}
                            </div>
                        </div>
                       <div class="capture_right">
                            <div class="capture_form_item">
                                <label>Social Networks</label>
                                <div class="whiteBox">
                                        {* linkedAccounts *}
                                </div>
                            </div>
                        </div>
                        <div class="capture_form_item">
                            <label>Password</label>
                            <p>&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;</p>
                            <p><a href="#" data-capturescreen="changepassword">Change Password</a></p>
                            <div class="capture_tip">
                                We have hidden your password for security reasons.
                            </div>
                        </div>
                        <div class="capture_form_item">
                            <label>Date of birth</label>
                            <p>{* birthdate *}</p>
                            <div class="capture_tip">
                                You cannot change your date of birth. None of us can&hellip;
                            </div>
                        </div>
                            {* gender *}
                            {* postcode *}
                            {* postcodeValidated *}
                        <a href="close-account.html" class="med btn"><span>Close Account</span></a>
                        {* /editProfileForm *}
                    </div>
                    <div style="display:none;" id="changepassword">
                        <h1>Change your password</h1>
                        {* newPasswordForm *}
                            {* currentpassword *}
                            {* newpassword *}
                            {* newpasswordConfirm *}
                            {* newPasswordFormButton *}
                        {* /newPasswordForm *}
                    </div>
                    <div style="display:none;" id="newPasswordSuccess">
                        <h1>Change password</h1>
                        <p>Your password has been successfully updated.</p>
                        <a href="#" class="btn med" onclick="janrain.capture.ui.modal.close();"><span>Close</span></a>
                    </div>
                </div>
            </div>
        </div>
        <div id="janrainEngageEmbed"  style="display:none;"></div>
    </body>
</html>
